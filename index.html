<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Guardians Remnant â€“ Step 4C Animated Transitions</title>
<style>
html,body{margin:0;background:#07131f;color:#9fdcff;font-family:system-ui}
#ui{
 position:fixed;top:10px;left:10px;
 background:rgba(0,0,0,.4);
 padding:10px;border-radius:8px;
 border:1px solid rgba(127,212,255,.35)
}
canvas{display:block}
</style>
</head>
<body>
<div id="ui">
<b>Step 4C</b>: Animated map transitions<br>
Tap blue tile = portal
</div>
<canvas id="game"></canvas>

<script>
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
const TILE=32;

let activeMap='Overworld';
let transitioning=false;
let fade=0;
let fadeDir=0;
let targetMap=null;

const maps={
 Overworld:{
  tiles:{'0,0':'g','1,0':'w'}
 },
 Dungeon:{
  tiles:{'0,0':'s','1,0':'g'}
 }
};

function resize(){
 canvas.width=innerWidth;
 canvas.height=innerHeight;
}
addEventListener('resize',resize);
resize();

function drawMap(name){
 const m=maps[name];
 for(const k in m.tiles){
  const [x,y]=k.split(',').map(Number);
  ctx.fillStyle=
    m.tiles[k]=='g'?'#4caf50':
    m.tiles[k]=='w'?'#4aa3ff':
    '#888';
  ctx.fillRect(x*TILE,y*TILE,TILE,TILE);
 }
}

function loop(){
 ctx.clearRect(0,0,canvas.width,canvas.height);

 if(!transitioning){
  drawMap(activeMap);
 } else {
  drawMap(activeMap);
  ctx.fillStyle=`rgba(0,0,0,${fade})`;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  fade+=fadeDir;
  if(fade>=1){
    activeMap=targetMap;
    fadeDir=-0.05;
  }
  if(fade<=0){
    fade=0;
    transitioning=false;
  }
 }

 requestAnimationFrame(loop);
}
loop();

canvas.addEventListener('click',e=>{
 const tx=Math.floor(e.offsetX/TILE);
 const ty=Math.floor(e.offsetY/TILE);

 if(transitioning) return;

 if(activeMap==='Overworld' && tx===1 && ty===0){
   transitioning=true;
   targetMap='Dungeon';
   fadeDir=0.05;
 }
 else if(activeMap==='Dungeon'){
   transitioning=true;
   targetMap='Overworld';
   fadeDir=0.05;
 }
});
</script>
</body>
</html>
